<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Le tue transazioni</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <h1>â‚¿itcoin on-chainğŸ”—</h1>
    <p>Qui puoi gestire le tue transazioni â‚¿itcoin on-chainğŸ”—</p>
    <form method="post" action="{{ url_for('nuova_transazione_onchain') }}">

      <label for="data">ğŸ“… Data:</label><br />
      <input type="date" id="data" name="data" value="{{ transazione_onchain['data'] }}" required /><br /><br />

      <label for="wallet">ğŸ‘› Wallet:</label><br />
      <input type="text" id="wallet" name="wallet" value="{{ transazione_onchain['wallet'] }}" required /><br /><br />

      <label for="descrizione">ğŸ“ Descrizione:</label><br />
      <input type="text" id="descrizione" name="descrizione" value="{{ transazione_onchain['descrizione'] }}" required /><br /><br />

      <label for="categoria">ğŸ“‚ Categoria:</label><br />
      <select name="categoria" id="categoria" onchange="popolaSottocategoria()" required>
        <option value="">-- Seleziona Categoria --</option>
          {% for cat in categorie %}
            <option value="{{ cat }}" {% if transazione_onchain['categoria'] == cat %}selected{% endif %}>{{ cat }}</option>
          {% endfor %}
      </select><br /><br />

      <label for="sottocategoria">ğŸ”– Sottocategoria:</label><br />
      <select name="sottocategoria" id="sottocategoria" required></select><br /><br />
      <label for="transactionID">ğŸ”— Transaction ID:</label><br />
      <input
      type="text"
      id="transactionID"
      name="transactionID"
      value="{{ transazione_onchain['transactionID'] }}"
      required
      /><br /><br />

      <label for="satoshi">â‚¿ Importo (â‚¿itcoin):</label><br />
      <input type="text" id="importo" name="importo_btc" value="{{ '%.8f' % (transazione_onchain['importo_btc'] or 0) }}"/><br /><br />

      <label for="fee">â‚¿ Importo fee (â‚¿itcoin):</label><br />
      <input type="text" id="fee" name="fee" value="{{ '%.8f' % (transazione_onchain['fee'] or 0) }}"/><br /><br />

      <button type="submit">âœ… Aggiungi</button>
    </form>

  <p><a href="/transazioni_onchain">â¬…ï¸ Torna alle transazioni On-chain ğŸ”—</a></p>

  <script>
    const categorie = {{ categorie_json | safe }};
    const categoriaAttuale = "{{ transazione_onchain['categoria'] }}";
    const sottocategoriaAttuale = "{{ transazione_onchain['sottocategoria'] }}";

    function popolaSottocategoria() {
      const categoriaSelezionata = document.getElementById("categoria").value;
      const sottoSel = document.getElementById("sottocategoria");
      sottoSel.innerHTML = "";

      if (categorie[categoriaSelezionata]) {
        categorie[categoriaSelezionata].forEach(sotto => {
          const opt = document.createElement("option");
          opt.value = sotto;
          opt.text = sotto;
          if (sotto === sottocategoriaAttuale) opt.selected = true;
          sottoSel.appendChild(opt);
        });
      } else {
        const opt = document.createElement("option");
        opt.value = "";
        opt.text = "-- Nessuna sottocategoria --";
        sottoSel.appendChild(opt);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("categoria").value = categoriaAttuale;
      popolaSottocategoria();
    });
  </script>
    <p><a href="/">â¬…ï¸ Torna alla home</a></p>
  </body>
</html>
