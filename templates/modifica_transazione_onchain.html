<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>âœï¸ Modifica Transazione On-Chain ğŸ”—</title>
  <link rel="icon" href="/static/img/favicon.ico" type="image/png" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  {% include "partials/logo.html" %}
  <h1>âœï¸ Modifica Transazione On-Chain ğŸ”—</h1>

  <form method="post" action="{{ url_for('modifica_transazione_web_onchain', id_transazione=transazione_onchain["id"]) }}">
    
    <label for="data">ğŸ“… Data:</label>
    <input type="date" id="data" name="data" value="{{ transazione_onchain["data"] }}" required /><br /><br />

    <label for="wallet">ğŸ‘› Wallet:</label>
    <input type="text" id="wallet" name="wallet" value="{{ transazione_onchain["wallet"] }}" required /><br /><br />

    <label for="descrizione">ğŸ“ Descrizione:</label>
    <input type="text" id="descrizione" name="descrizione" value="{{ transazione_onchain["descrizione"] }}" required /><br /><br />

    <label for="categoria">ğŸ“‚ Categoria:</label>
    <select name="categoria" id="categoria" onchange="popolaSottocategoria()" required>
      <option value="">-- Seleziona Categoria --</option>
      {% for cat in categorie %}
        <option value="{{ cat }}" {% if transazione_onchain["categoria"] == cat %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select><br /><br />

    <label for="sottocategoria">ğŸ”– Sottocategoria:</label>
    <select name="sottocategoria" id="sottocategoria" required></select><br /><br />
    <label for="transactionID">ğŸ”— Transaction ID:</label>
    <input
      type="text"
      id="transactionID"
      name="transactionID"
      value="{{ transazione_onchain["transactionID"] }}"
      required
      /><br /><br />

    <label for="satoshi">â‚¿ Importo (â‚¿itcoin):</label>
    <input type="text" id="importo" name="importo_btc" value="{{ '%.8f' % (transazione_onchain["importo_btc"] or 0) }}"/><br /><br />

    <label for="fee">â‚¿ Importo fee (â‚¿itcoin):</label>
    <input type="text" id="fee" name="fee" value="{{ '%.8f' % (transazione_onchain["fee"] or 0) }}"/><br /><br />

    <button type="submit">âœ… Salva Modifiche</button>
  </form>

  <p><a href="/transazioni_lightning">â¬…ï¸ Torna alle transazioni On-Chain</a></p>

  <script>
    const categorie = {{ categorie_json | safe }};
    const categoriaAttuale = "{{ transazione_onchain["categoria"] }}";
    const sottocategoriaAttuale = "{{ transazione_onchain["sottocategoria"] }}";

    function popolaSottocategoria() {
      const categoriaSelezionata = document.getElementById("categoria").value;
      const sottoSel = document.getElementById("sottocategoria");
      sottoSel.innerHTML = "";

      if (categorie[categoriaSelezionata]) {
        categorie[categoriaSelezionata].forEach(sotto => {
          const opt = document.createElement("option");
          opt.value = sotto;
          opt.text = sotto;
          if (sotto === sottocategoriaAttuale) opt.selected = true;
          sottoSel.appendChild(opt);
        });
      } else {
        const opt = document.createElement("option");
        opt.value = "";
        opt.text = "-- Nessuna sottocategoria --";
        sottoSel.appendChild(opt);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("categoria").value = categoriaAttuale;
      popolaSottocategoria();
    });
  </script>
</body>
</html>
