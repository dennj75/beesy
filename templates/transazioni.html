<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Le tue transazioni</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header style="display:flex;justify-content:space-between;align-items:center;">
      <h1>ğŸ“‹ Transazioni â‚¬</h1>
      <nav>
        {% if current_user.is_authenticated %}
          <span>Ciao, {{ current_user.username }}</span>
          <a href="{{ url_for('auth.logout') }}">Logout</a>
        {% else %}
          <a href="{{ url_for('auth.login') }}">Login</a>
          <a href="{{ url_for('auth.register') }}">Register</a>
        {% endif %}
      </nav>
    </header>
    <!-- Qui il saldo totale -->
    <div class="saldi-container">
      <p class="saldo-banca {% if saldo_banca >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}">
        ğŸ¦ Banca: {{ "%.2f"|format(saldo_banca) }} â‚¬</p>
      </p>
      <p class="saldo-contanti {% if saldo_contanti >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}">
        ğŸ’¼ Contanti: {{ "%.2f"|format(saldo_contanti) }} â‚¬</p>
      <p class="saldo-totale">
        ğŸ’° Saldo Totale: {{ "%.2f"|format(saldo_totale) }} â‚¬
      </p>
    </div>
    </p>
    <div class="csv-buttons">
      <a href="{{ url_for('scarica_csv') }}">
      <button type="button" class="csv-button">ğŸ“¥ Esporta CSV</button>
      </a>
      <a href="{{ url_for('scarica_csv_per_mese') }}">
      <button type="button" class="csv-button">ğŸ“¥Esporta CSV per mese</button>
      </a>
    </div>
    <div class="nuova-transazione">
      <p><a href="/nuova_transazione">â• Aggiungi una nuova transazione</a></p>
    </div>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul>
          {% for category, message in messages %}
            {% if 'euro' in category %}
              <li class="{{ category }}">{{ message }}</li>
            {% endif %}
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    
    <table border="1">
      <tr>
        <th>ID</th>
        <th>Data</th>
        <th>Descrizione</th>
        <th>Categoria</th>
        <th>Sottocategoria</th>
        <th>Importo (â‚¬)</th>
        <th>Controvalore BTC</th>
        <th>Valore BTC</th>
        <th>Conto</th>
        <th>Azioni</th>
      </tr>
      {% for t in transazioni %}
      <tr>
        <td>{{ t.id }}</td>
        <td>{{ t.data }}</td>
        <td>{{ t.descrizione }}</td>
        <td>{{ t.categoria }}</td>
        <td>{{ t.sottocategoria }}</td>

        <td class="{% if t.importo >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}">
          {{ "%.2f"|format(t.importo) }} â‚¬
        </td>

        <td>
        {% if t.controvalore_btc %}
          {{ "%.8f"|format(t.controvalore_btc) }}
          {% else %}
          -
        {% endif %}
      </td>

      <td>
      {% if t.valore_btc_eur %}
        {{ "%.2f"|format(t.valore_btc_eur) }}
      {% else %}
        -
      {% endif %}
      </td>

      <td>
        {% if t.conto.lower() == "banca" %}
          ğŸ¦ Banca
        {% elif t.conto.lower() == "contanti" %}
          ğŸ’¶ Contanti
        {% else %}
          {{ t.conto }}
        {% endif %}
      </td>

      <td>
      <form method="post" action="{{ url_for('elimina_transazione_eur', id_transazione=t.id) }}" style="display:inline;">
        <button type="submit" onclick="return confirm('Sei sicuro di voler eliminare questa transazione?');">ğŸ—‘ï¸ Elimina</button>
      </form>

      <a href="{{ url_for('modifica_transazione_eur', id_transazione=t.id) }}">âœï¸ Modifica</a>
      </td>
      </tr>
        {% endfor %}
    </table>

    <p><a href="/">â¬…ï¸ Torna alla home</a></p>
  </body>
</html>
