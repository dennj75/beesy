<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>âœï¸ Modifica Transazione Lightning âš¡ï¸</title>
  <link rel="icon" href="/static/img/favicon.ico" type="image/png" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  {% include "partials/logo.html" %}
  <h1>âœï¸ Modifica Transazione Lightning âš¡ï¸</h1>

  <form method="post" action="{{ url_for('modifica_transazione_web_lightning', id_transazione=transazione_lightning["id"]) }}">
    
    <label for="data">ğŸ“… Data:</label>
    <input type="date" id="data" name="data" value="{{ transazione_lightning[1] }}" required /><br /><br />

    <label for="wallet">ğŸ‘› Wallet:</label>
    <input type="text" id="wallet" name="wallet" value="{{ transazione_lightning[2] }}" required /><br /><br />

    <label for="descrizione">ğŸ“ Descrizione:</label>
    <input type="text" id="descrizione" name="descrizione" value="{{ transazione_lightning[3] }}" required /><br /><br />

    <label for="categoria">ğŸ“‚ Categoria:</label>
    <select name="categoria" id="categoria" onchange="popolaSottocategoria()" required>
      <option value="">-- Seleziona Categoria --</option>
      {% for cat in categorie %}
        <option value="{{ cat }}" {% if transazione_lightning[4] == cat %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select><br /><br />

    <label for="sottocategoria">ğŸ”– Sottocategoria:</label>
    <select name="sottocategoria" id="sottocategoria" required></select><br /><br />

    <label for="satoshi">âš¡ï¸ Importo (satoshi):</label>
    <input type="number" id="satoshi" name="satoshi" min="-1000000" max="1000000" value="{{ transazione_lightning[6] }}" required /><br /><br />

    <button type="submit">âœ… Salva Modifiche</button>
  </form>

  <p><a href="/transazioni_lightning">â¬…ï¸ Torna alle transazioni Lightning</a></p>

  <script>
    const categorie = {{ categorie_json | safe }};
    const categoriaAttuale = "{{ transazione_lightning[4] }}";
    const sottocategoriaAttuale = "{{ transazione_lightning[5] }}";

    function popolaSottocategoria() {
      const categoriaSelezionata = document.getElementById("categoria").value;
      const sottoSel = document.getElementById("sottocategoria");
      sottoSel.innerHTML = "";

      if (categorie[categoriaSelezionata]) {
        categorie[categoriaSelezionata].forEach(sotto => {
          const opt = document.createElement("option");
          opt.value = sotto;
          opt.text = sotto;
          if (sotto === sottocategoriaAttuale) opt.selected = true;
          sottoSel.appendChild(opt);
        });
      } else {
        const opt = document.createElement("option");
        opt.value = "";
        opt.text = "-- Nessuna sottocategoria --";
        sottoSel.appendChild(opt);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("categoria").value = categoriaAttuale;
      popolaSottocategoria();
    });
  </script>
</body>
</html>
