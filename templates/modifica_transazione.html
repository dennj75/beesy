<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modifica transazione</title>
  <link rel="icon" href="/static/img/favicon.ico" type="image/png" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  {% include "partials/logo.html" %}
  <h1>‚úèÔ∏è Modifica Transazione</h1>

  <form method="post" action="{{ url_for('modifica_transazione_eur', id_transazione=transazione['id']) }}">
    <label>Data:</label>
    <input type="date" name="data" value="{{ transazione['data'] }}" required><br><br>

    <label>Descrizione:</label>
    <input type="text" name="descrizione" value="{{ transazione['descrizione'] }}" required><br><br>

    <label>Categoria:</label>
    <select name="categoria" id="categoria" onchange="popolaSottocategoria()" required>
      <option value="">-- Seleziona Categoria --</option>
      {% for cat in categorie %}
        <option value="{{ cat }}" {% if transazione['categoria'] == cat %}selected{% endif %}>{{ cat }}</option>
      {% endfor %}
    </select><br><br>

    <label>Sottocategoria:</label>
    <select name="sottocategoria" id="sottocategoria" required></select><br><br>

    <label>Importo (‚Ç¨):</label>
    <input type="text" name="importo" value="{{ '%.2f'|format(transazione['importo']|float) }}" required><br><br>

    <label>Conto:</label>
    <select name="conto" required>
      <option value="BANCA" {% if transazione['conto'] == "BANCA" %}selected{% endif %}>üè¶ BANCA</option>
      <option value="CONTANTI" {% if transazione['conto'] == "CONTANTI" %}selected{% endif %}>üí∂ CONTANTI</option>
    </select><br><br>

    <button type="submit">‚úÖ Salva Modifiche</button>
  </form>

  <p><a href="{{ url_for('transazioni') }}">‚¨ÖÔ∏è Torna alle transazioni</a></p>

  <script>
    const categorie = {{ categorie_json | safe }};
    const categoriaAttuale = "{{ transazione['categoria'] }}";
    const sottocategoriaAttuale = "{{ transazione['sottocategoria'] }}";

    function popolaSottocategoria() {
      const categoriaSel = document.getElementById("categoria").value;
      const sottoSel = document.getElementById("sottocategoria");
      sottoSel.innerHTML = "";

      if (categorie[categoriaSel]) {
        categorie[categoriaSel].forEach(sotto => {
          const opt = document.createElement("option");
          opt.value = sotto;
          opt.text = sotto;
          if (sotto === sottocategoriaAttuale) opt.selected = true;
          sottoSel.appendChild(opt);
        });
      } else {
        const opt = document.createElement("option");
        opt.value = "";
        opt.text = "-- Nessuna sottocategoria --";
        sottoSel.appendChild(opt);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      popolaSottocategoria();
    });
  </script>
</body>
</html>

