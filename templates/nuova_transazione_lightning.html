<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Nuova transazione Lightning âš¡ï¸</title>
    <link rel="icon" href="/static/img/favicon.ico" type="image/png" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    {% include "partials/logo.html" %}
    <h1>â• Nuova transazione Lightning âš¡ï¸</h1>

    <form method="post" action="/nuova_transazione_lightning">
      <label for="data">ğŸ“… Data:</label>
      <input type="date" id="data" name="data" required /><br /><br />

      <label for="wallet">ğŸ‘› Wallet:</label>
      <input type="text" id="wallet" name="wallet" required /><br /><br />

      <label for="descrizione">ğŸ“ Descrizione:</label>
      <input
        type="text"
        id="descrizione"
        name="descrizione"
        required
      /><br /><br />

      <label for="categoria">ğŸ“‚ Categoria:</label>
      <select
        name="categoria"
        id="categoria"
        onchange="popolaSottocategoria()"
        required
      >
        <option value="">-- Seleziona Categoria --</option>
        {% for cat in categorie %}
        <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}</select
      ><br /><br />

      <label for="sottocategoria">ğŸ”– Sottocategoria:</label>
      <select name="sottocategoria" id="sottocategoria" required></select
      ><br /><br />

      <label for="satoshi">âš¡ï¸ Importo (satoshi):</label>
      <input
        type="number"
        id="satoshi"
        name="satoshi"
        min="-1000000"
        max="1000000"
        required
      /><br /><br />

      <button type="submit">âœ… Aggiungi</button>
    </form>

    <p>
      <a href="{{ url_for('transazioni_lightning') }}"
        >â¬…ï¸ Torna alle transazioni Lightning âš¡ï¸</a
      >
    </p>
    <p><a href="{{ url_for('home') }}">â¬…ï¸ Torna alla Home</a></p>
    <script>
      const categorie = {{ categorie_json | safe }};
      const sottocategoriaAttuale = "";

      function popolaSottocategoria() {
        const categoriaSelezionata = document.getElementById("categoria").value;
        const sottoSel = document.getElementById("sottocategoria");
        sottoSel.innerHTML = "";

        if (categorie[categoriaSelezionata]) {
          categorie[categoriaSelezionata].forEach(sotto => {
            const opt = document.createElement("option");
            opt.value = sotto;
            opt.text = sotto;
            sottoSel.appendChild(opt);
          });
        } else {
          const opt = document.createElement("option");
          opt.value = "";
          opt.text = "-- Nessuna sottocategoria --";
          sottoSel.appendChild(opt);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        popolaSottocategoria();
      });
    </script>
  </body>
</html>
