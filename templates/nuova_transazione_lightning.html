<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Nuova transazione Lightning âš¡ï¸</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <h1>â• Nuova transazione Lightning âš¡ï¸</h1>

    <form method="post" action="/nuova_transazione_lightning">
      <label for="data">ğŸ“… Data:</label><br />
      <input type="date" id="data" name="data" required /><br /><br />

      <label for="wallet">ğŸ‘› Wallet:</label><br />
      <input type="text" id="wallet" name="wallet" required /><br /><br />

      <label for="descrizione">ğŸ“ Descrizione:</label><br />
      <input
        type="text"
        id="descrizione"
        name="descrizione"
        required
      /><br /><br />

      <label for="categoria">ğŸ“‚ Categoria:</label><br />
      <select
        name="categoria"
        id="categoria"
        onchange="popolaSottocategoria()"
        required
      >
        <option value="">-- Seleziona Categoria --</option>
        {% for cat in categorie %}
        <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}</select
      ><br /><br />

      <label for="sottocategoria">ğŸ”– Sottocategoria:</label><br />
      <select name="sottocategoria" id="sottocategoria" required></select
      ><br /><br />

      <label for="satoshi">âš¡ï¸ Importo (satoshi):</label><br />
      <input
        type="number"
        id="satoshi"
        name="satoshi"
        min="-1000000"
        max="1000000"
        required
      /><br /><br />

      <button type="submit">âœ… Aggiungi</button>
    </form>

    <p><a href="/">â¬…ï¸ Torna alla home</a></p>

    <script>
      const categorie = {{ categorie_json | safe }};
      const sottocategoriaAttuale = "";

      function popolaSottocategoria() {
        const categoriaSelezionata = document.getElementById("categoria").value;
        const sottoSel = document.getElementById("sottocategoria");
        sottoSel.innerHTML = "";

        if (categorie[categoriaSelezionata]) {
          categorie[categoriaSelezionata].forEach(sotto => {
            const opt = document.createElement("option");
            opt.value = sotto;
            opt.text = sotto;
            sottoSel.appendChild(opt);
          });
        } else {
          const opt = document.createElement("option");
          opt.value = "";
          opt.text = "-- Nessuna sottocategoria --";
          sottoSel.appendChild(opt);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        popolaSottocategoria();
      });
    </script>
  </body>
</html>
