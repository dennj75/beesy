<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>ğŸ”— Transazioni â‚¿itcoin On-chain ğŸ”—</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <header
      style="display: flex; justify-content: space-between; align-items: center"
    >
      <h1>ğŸ”— Transazioni â‚¿itcoin On-chain ğŸ”—</h1>
      <nav>
        {% if current_user.is_authenticated %}
        <span>Ciao, {{ current_user.username }}</span>
        <a href="{{ url_for('auth.logout') }}">Logout</a>
        {% else %}
        <a href="{{ url_for('auth.login') }}">Login</a>
        <a href="{{ url_for('auth.register') }}">Register</a>
        {% endif %}
      </nav>
    </header>
    <!-- ğŸ”¹ Saldo SATOSHI -->
    <p class="saldo-totale">
      ğŸ’° Saldo â‚¿itcoin On-chainğŸ”—: {{ "%.8f"|format(saldo_totale_btc) }} BTC
    </p>
    <!-- ğŸ”¹ Controvalore totale in EUR (opzionale) -->
    {% if transazioni_onchain %} {% set totale_eur = transazioni_onchain |
    map(attribute="controvalore_eur") | sum %}
    <p class="saldo-totale">
      ğŸ’¶ Controvalore Totale: {{ "%.2f"|format(totale_eur) }} â‚¬
    </p>
    {% endif %}

    <div class="csv-buttons">
      <a href="{{ url_for('scarica_csv_onchain') }}">
        <button type="button" class="csv-button">ğŸ“¥ Esporta CSV</button>
      </a>
      <a href="{{ url_for('scarica_csv_per_mese_onchain') }}">
        <button type="button" class="csv-button">
          ğŸ“¥ Esporta CSV per mese
        </button>
      </a>
    </div>
    <p>
      <a href="{{ url_for('nuova_transazione_onchain') }}"
        >â• Aggiungi una nuova transazione On-chain</a
      >
    </p>
    {% with messages = get_flashed_messages(with_categories=true) %} {% if
    messages %}
    <ul>
      {% for category, message in messages %} {% if 'onchain' in category %}
      <li class="{{ category }}">{{ message }}</li>
      {% endif %} {% endfor %}
    </ul>
    {% endif %} {% endwith %}

    <table border="1">
      <tr>
        <th>ID</th>
        <th>Data</th>
        <th>Wallet</th>
        <th>Descrizione</th>
        <th>Categoria</th>
        <th>Sottocategoria</th>
        <th>TransactionID</th>
        <th>Importo BTC</th>
        <th>fee</th>
        <th>Controvalore â‚¬</th>
        <th>Valore BTC/â‚¬</th>
      </tr>
      {% for t in transazioni_onchain %}
      <tr>
        <td>{{ t["id"] }}</td>
        <td>{{ t["data"] }}</td>
        <td>{{ t["wallet"] }}</td>
        <td>{{ t["descrizione"] }}</td>
        <td>{{ t["categoria"] }}</td>
        <td>{{ t["sottocategoria"] }}</td>
        <td>{{ t["transactionID"] }}</td>
        <td
          class="{% if t["importo_btc"] >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}"
        >
          {{ '%.8f' % t["importo_btc"] if t["importo_btc"] is not none else '0.00000000' }}
        </td>
        <td
          class="{% if t["fee"] >= 0 %}importo-positivo{% else %}importo-negativo{% endif %}"
        >
          {{ '%.8f' % t["fee"] if t["fee"] is not none else '0.00000000' }}
        </td>

        <td>{{ "%.2f"|format(t["controvalore_eur"]) }}</td>
        <td>{{ "%.2f"|format(t["valore_btc_eur"]) }}</td>
        <td>
          <form
            method="post"
            action="{{ url_for('elimina_transazione_web_onchain', id_transazione=t["id"]) }}"
            style="display: inline"
          >
            <button
              type="submit"
              onclick="return confirm('Sei sicuro di voler eliminare questa transazione On-chain?');"
            >
              ğŸ—‘ï¸ Elimina
            </button>
          </form>
          <a
            href="{{ url_for('modifica_transazione_web_onchain', id_transazione=t["id"]) }}"
            >âœï¸ Modifica</a
          >
        </td>
      </tr>
      {% endfor %}
    </table>

    <p><a href="/">â¬…ï¸ Torna alla home</a></p>
  </body>
</html>
